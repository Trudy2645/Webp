<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‚´ ìœ„ì‹œë¦¬ìŠ¤íŠ¸</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { font-family: 'Pretendard', sans-serif; background-color: #f4f6f9; }
    header {
      background-color: #ffffff;
      border-bottom: 1px solid #dee2e6;
      padding: 1.2rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    header h1 {
      font-weight: 800;
      font-size: 1.8rem;
      margin: 0;
      color: #212529;
    }
    nav a {
      margin-left: 1.5rem;
      color: #495057;
      text-decoration: none;
      font-weight: 500;
    }
    nav a:hover {
      color: #0d6efd;
    }
    main { background-color: #ffffff; padding: 30px 40px; border-radius: 16px; box-shadow: 0 6px 16px rgba(0,0,0,0.1); width: 80%; max-width: 900px; margin: 2rem auto; }
    .wishlist-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      border-bottom: 1px solid #eee;
    }
    .wishlist-item:last-child { border-bottom: none; }
    .wishlist-item img { /* Added style for product images in wishlist */
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-right: 15px;
      border-radius: 5px;
    }
    .item-info {
      flex-grow: 1; /* Allows info to take available space */
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .item-info h4 { margin: 0; font-weight: 600; color: #343a40; }
    .item-info p { margin: 5px 0 0; color: #6c757d; font-size: 0.95rem;}
    .item-info .price { font-weight: bold; color: #0d6efd; }
    footer {
      margin-top: 4rem;
      padding: 2rem 0;
      background-color: #ffffff;
      border-top: 1px solid #dee2e6;
      color: #868e96;
      font-size: 0.9rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸª¬ ë‚´ ìœ„ì‹œë¦¬ìŠ¤íŠ¸</h1> <% // Changed header title for clarity %>
    <nav>
      <a href="/">í™ˆ</a>
      <a href="/products">ìƒí’ˆëª©ë¡</a>
      <a href="/cart">ì¥ë°”êµ¬ë‹ˆ</a>
      <a href="/wishlist">ìœ„ì‹œë¦¬ìŠ¤íŠ¸</a>
      <a href="/board">ê³ ê°ì„¼í„°</a>
      <% if (user) { %>
        <a href="/user/logout">ë¡œê·¸ì•„ì›ƒ</a>
      <% } else { %>
        <a href="/login">ë¡œê·¸ì¸</a>
        <a href="/user/register">íšŒì›ê°€ì…</a>
      <% } %>
    </nav>
  </header>

  <main>
    <h2>ë‚´ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ âœ¨</h2>
    <% if (wishlistItems && wishlistItems.length > 0) { %>
      <ul class="list-unstyled">
        <% wishlistItems.forEach(item => { %>
          <li class="wishlist-item">
            <% // item.imageê°€ ì¡´ì¬í•˜ê³  ë¹„ì–´ìˆì§€ ì•Šì€ ë¬¸ìì—´ì¸ì§€ í™•ì‹¤íˆ í™•ì¸í•©ë‹ˆë‹¤.
               // í˜¹ì‹œ ëª¨ë¥¼ ê²½ë¡œ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ì¢€ ë” ëª…í™•í•˜ê²Œ ì§€ì •í•´ë´…ë‹ˆë‹¤.
            %>
            <% if (item.image && item.image.trim() !== '') { %>
              <img src="/images/<%= item.image %>" alt="<%= item.name %> ì´ë¯¸ì§€">
            <% } else { %>
              <img src="/images/default.png" alt="ì´ë¯¸ì§€ ì—†ìŒ"> <% } %>
            <div class="item-info">
              <h4><%= item.emoji || '' %> <%= item.name %></h4>
              <p><%= item.description %></p>
              <p class="price">ê°€ê²©: <%= item.price.toLocaleString() %>ì›</p>
            </div>
            <button class="btn btn-danger remove-from-wishlist-btn" data-product-id="<%= item.id %>">
              ì‚­ì œ
            </button>
          </li>
        <% }); %>
      </ul>
    <% } else { %>
      <p>ìœ„ì‹œë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
    <% } %>
  </main>

  <footer>
    <p>&copy; 2025 ê³ ê°ì„¼í„° ì‹œìŠ¤í…œ. All rights reserved.</p>
  </footer>

  <script>
    document.querySelectorAll('.remove-from-wishlist-btn').forEach(button => {
      button.addEventListener('click', async (event) => {
        const productId = event.target.dataset.productId;
        if (confirm('ì •ë§ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì—ì„œ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          try {
            const response = await fetch('/wishlist/remove', {
              method: 'POST', // DELETE ìš”ì²­ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ë„ ìˆìŒ
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ productId: productId }),
            });
            const data = await response.json();
            if (response.ok) { // Check for successful HTTP status (2xx)
              alert(data.message);
              window.location.reload(); // ì„±ê³µ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            } else {
              alert(data.message || 'ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì‚­ì œ ì‹¤íŒ¨');
            }
          } catch (error) {
            console.error('Error removing from wishlist:', error);
            alert('ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        }
      });
    });
  </script>
</body>
</html>